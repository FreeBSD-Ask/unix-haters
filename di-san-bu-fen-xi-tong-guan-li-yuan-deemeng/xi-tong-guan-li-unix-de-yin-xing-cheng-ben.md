# 系统管理：Unix 的隐形成本

![](../.gitbook/assets/part3.png)

---

![](../.gitbook/assets/part33.png)


>如果汽车的发展与计算机相同，那么今天一辆劳斯莱斯的价格会是 100 美元，油耗每加仑能跑一百万英里，并且每年爆炸一次，杀死车内所有人。
>
>—— Robert Cringely, InfoWorld

所有 Unix 系统都需要一名系统管理员，亲切地被称为 Sysadmin。Sysadmin 的职责包括：

* 启动系统
* 安装新软件
* 管理用户账户
* 调优系统以获得最大性能
* 监督系统安全
* 执行常规备份
* 关闭系统以安装新硬件
* 帮助用户解决问题

Unix sysadmin 的工作与负责 IBM 大型主机或基于 PC 的 Novell 网络的 sysadmin 没有根本区别。但与其他操作系统不同，Unix 使得这些任务比其他操作系统更加困难且昂贵。本章的主题是，维护一个 Unix 系统的经济性非常差，保持 Unix 运行的总体成本远高于维护其承载硬件的成本。

网络化的 Unix 工作站比独立的 Unix 工作站需要更多的管理，因为 Unix 偶尔会在网络上乱丢垃圾。据估计，每 10-25 台 Unix 工作站就会创造至少一个全职系统管理员职位，这使得系统管理员成为一个有前景的职业。当然，类似的网络，如果是 Mac 或 PC，也需要有人来执行 sysadmin 工作。但这位人员通常并不会全职维持系统的正常运行，也不会将 Unix 的熵水平控制在一个可用的范围内。

这个人通常有其他工作，或者是多种应用的顾问。有些 Unix sysadmin 被自己的工作压得喘不过气来。

> 日期：1991 年 6 月 5 日 星期三 14:13:38 EDT
> 
> 发件人：Bruce Howard [bhoward@citi.umich.edu](mailto:bhoward@citi.umich.edu)
> 
> 收件人：Unix 痛恨者
> 
> 主题：我的故事
>
> 过去两天里，我收到了成百上千封来自 Unix uucp 邮件系统的“您的邮件尚未送达”消息，该系统无法正确地退回邮件。我被攻击、侮辱、挫败，情感受到了伤害，因为 sendmail 进程未能检测到，或者更糟的是，正是这些进程导致了以下各种问题：邮件循环、重复的未知错误号 1 消息，以及神秘且任意修改的邮件头，其中包括各个字段中的所有地址和日期。
>
> Unix 让我整天忙个不停，做安装、重装、重格式化、重启，似乎特别喜欢在周五结束时肆意破坏我的文件系统。我的女朋友已经离开我（她喃喃道：“黑客是个肮脏的习惯，Unix 就是黑客的毒品”），而我已经忘记了 Shift 键的位置。我的表达已经不再正常，绝望成了我的伴侣。
>
> 我求你们，帮帮我，拜托了。


每年支付 \$40,000 来维护 20 台机器，相当于每台机器每年的费用为 \$2000。典型的低端 Unix 工作站价格在 \$3000 到 \$5000 之间，并且大约每两年就会更换一次。如果将这些费用与机器和软件的成本结合起来，就很明显，所谓的“开放系统”解决方案，并不真的具有成本效益。


## 保持 Unix 运行和调优

系统管理员是高薪的保姆。就像婴儿把本来好的输入转化为排泄物，然后把它丢进尿布里，Unix 也会以核心转储、无效的临时文件、癌症般的日志文件和不合法的网络重播的形式，把“排泄物”撒遍其文件系统和网络。但与婴儿不同，婴儿可能会把这些“排泄物”涂抹到周围，但通常会把它们保持在尿布里，而 Unix 却与它的垃圾玩起了躲猫猫。如果没有经验丰富的系统管理员去清理这些垃圾，系统会慢慢耗尽空间，开始发臭，变得不舒适，最终报错或直接崩溃。

有些系统的“排泄物”多到需要自动更换“尿布”：

> 日期：1990 年 9 月 20 日 04:22:36 GMT
> 
> 发件人：[alan@mq.com](mailto:alan@mq.com) (Alan H. Mintz)
> 
> 主题：Re: uucp 核心转储文件
> 
> 新sgroups：comp.unix.xenix.sco
>
> 在文章 [2495@polari.UUCP](mailto:2495@polari.UUCP) 中，[corwin@polari.UUCP](mailto:corwin@polari.UUCP) (Don Glover) 写道：
>
> 很长一段时间以来，我一直收到来自 uucp 转储文件的消息，位于 `/usr/spool/uucp`，确实，我过去查看时发现有一个核心转储文件，我把它删掉了，它又回来了……
>
> 是的。SCO HDB uucp 的发布说明中指出：“uucico 通常会生成核心转储文件。”这很正常。事实上，默认的 SCO 安装包含一个 cron 脚本，它会定期删除 `/usr/spool/uucp` 中的核心转储文件。


保姆在宝宝不活跃时浪费时间看电视（其中一些人做作业）；而系统管理员则坐在电视前，阅读网络新闻，同时观察警告、错误和用户投诉（其中一些人也做作业）。大型 Unix 系统网络不喜欢离他们的“母亲”——系统管理员太远，管理员经常在晚上从家里拨打电话给系统，给它“拍嗝”。


### Unix 系统在几周内变得老态龙钟，而不是几年。

Unix 最初是在一个研究环境中开发的，在那个环境里，系统很少能保持连续运行几天。它并没有被设计成能够长时间运行，更不用说持续不断地运行了。加剧这个问题的是，Unix 工具和应用程序（尤其是伯克利的那些）似乎是这样开发的：程序员编写一些代码，编译它，运行它，然后等待它崩溃。没有崩溃的程序被假定为正确运行。对于第三方应用程序开发者至关重要的生产质量保证，并不是开发文化的一部分。

虽然这种方法对于操作系统课程中的学期项目足够了，但它根本无法发现生产代码中出现的“代码癌症”，这些代码必须能够持续运行数天、数周或数月。难怪大多数主要的 Unix 系统都会出现内存泄漏、垃圾积累和地址空间缓慢腐败的问题——这些问题通常只有在程序运行了几天后才会显现出来。

由于难以将调试器附加到正在运行的程序上（而将调试器附加到崩溃的程序上几乎是不可能的），这使得无法调查一个已经运行多天、然后突然失败的程序。因此，通常 bug 无法修复（甚至无法追踪），而定期重启 Unix 是保持其不表现出阿尔茨海默病的最可靠方式。

> 日期：1992 年 2 月 29 日 17:30:41 PST
> 
> 发件人：Richard Mlynarik [mly@lcs.mit.edu](mailto:mly@lcs.mit.edu)
> 
> 收件人：UNIX-HATERS
> 
> 主题：我还以为是闰年呢
> 
>
> 所以，我现在在 2 月 29 日因为 Unix 而陷入困境：
> 
>```sh
>% make -k xds
>sh: Bus error
>make: Fatal error: The command `date "+19%y 13
>* %m + 32 * %d + 24 * %H + 60 * %M + p" | dc'
>returned status `19200'
>Compilation exited abnormally with code 1 at
>Sat Feb 29 17:01:34
>```
>我开始真的很想写一封激烈的邮件，抱怨 Unix 在处理闰年日期时出错，但经过进一步检查——而且，哪个 Unix 故障不让人忍不住进行更多无谓、得不到结论、令人沮丧的检查呢？——我发现实际的 bug 是这台机器已经运行太久了。
>
> 我发现这一点是因为 ispell 程序告诉我：
>
>```sh
>swap space exhausted for mmap data of
>/usr/lib/libc.so.1.6 is not a known word
>```
>
>现在，突然之间，显而易见，实际上这台可怜的机器已经在 11 天、1 小时和 10 分钟的核心转储和调试调试过程中，填满了它的分页空间，里面充满了没有垃圾回收、没有压缩的“吐司饼屑”。
>
> 现在，已经远远超出了“该重启的时候”！

Richard Mlynarik 的信息中，最令人惊讶的，当然是他所使用的那版 Unix 系统竟然还没有自行重启。

